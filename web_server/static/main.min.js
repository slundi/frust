async function q(e,t,d){var s={Accept:"application/json","Content-Type":"application/json"},l=localStorage.getItem("token");null!=l&&(s.Authorization="token "+l);var n={method:t,headers:s};null!=d&&(n.body=JSON.stringify(d));const o=await fetch(e,n);return o}function get_link(e,t,d){var s=document.createElement("a");return s.setAttribute("href",e),null!=d&&s.setAttribute("class",d),s.innerHTML=t,s}function get_folder_dropdown(e){var t=document.createElement("div");t.setAttribute("class","dropdown is-hoverable");var d=document.createElement("div");d.setAttribute("class","dropdown-trigger"),d.innerHTML='<button class="button is-small"><span>...</span></button>',t.append(d);var s=document.createElement("div");s.setAttribute("class","dropdown-menu"),s.setAttribute("id","ddd-"+e),t.append(s);var l=document.createElement("div");l.setAttribute("class","dropdown-content"),l.append(get_link("javascript:read_folder('"+e+"')",'<i class="mdi mdi-check-all"></i> Mark all as read',"dropdown-item")),l.append(get_link("javascript:share('"+e+"')",'<i class="mdi mdi-share-variant"></i> Share',"dropdown-item")),l.append(get_link("javascript:filter_folder('"+e+"')",'<i class="mdi mdi-filter-cog"></i> Filter',"dropdown-item")),l.append(get_link("javascript:modal_folder('"+e+"')",'<i class="mdi mdi-form-textbox"></i> Rename',"dropdown-item"));var n=document.createElement("hr");return n.setAttribute("class","dropdown-divider"),l.append(n),l.append(get_link("javascript:delete_folder('"+e+"')",'<i class="mdi mdi-delete"></i> Delete',"dropdown-item")),s.append(l),t}function display_folders(){var e=document.getElementById("folders"),t=document.getElementById("feed_folder");e.textContent="",t.textContent="";for(const i of folders){const a=i.hash_id;var d=document.createElement("li"),s=document.createElement("a");s.setAttribute("href","#"),s.setAttribute("id","f_"+a),s.innerHTML='<i class="mdi mdi-folder"></i> '+i.name,console.log("TODO FOLDERS"),d.append(s);var l=document.createElement("span");l.setAttribute("class","is-pullled-right");var n=document.createElement("div");n.textContent="0",n.setAttribute("id","f_n_"+a),n.setAttribute("class","tag is-rounded"),l.append(n),l.append(get_folder_dropdown(a)),d.append(l),e.append(d);var o=document.createElement("option");o.setAttribute("value",a),o.textContent=i.name,t.append(o)}}function get_folders(){q("folders/","GET",null).then(e=>{200===e.status&&e.json().then(e=>{folders=e,display_folders()})})}function update_ui(e){let t=Array.from(document.getElementsByClassName("l"));e?(t.forEach(e=>{e.classList.remove("is-hidden")}),document.getElementById("anonymous").classList.add("is-hidden"),get_folders(),q("feeds/","GET",null).then(e=>{200===e.status&&console.log("TODO FEEDS")})):(t.forEach(e=>{e.classList.add("is-hidden")}),document.getElementById("anonymous").classList.remove("is-hidden"))}function logout(){localStorage.clear(),update_ui(!1)}function login(){let e=document.getElementById("lu").value,t=document.getElementById("lp").value;q("login","POST",{username:e,clear_password:t}).then(e=>{200===e.status?(document.getElementById("wrong_credentials").classList.add("is-hidden"),e.json().then(e=>{localStorage.setItem("token",e),update_ui(!0)})):document.getElementById("wrong_credentials").classList.remove("is-hidden")},function(e){})}function register(){let e=document.getElementById("ru"),t=document.getElementById("rp"),d=document.getElementById("rpc");t.value!=d.value&&document.getElementById("rpc_diff").classList.remove("is-hidden"),q("account","POST",{username:e.value,clear_password:t.value,clear_password_2:d.value}).then(s=>{201===s.status?(document.getElementById("ru_exists").classList.add("is-hidden"),document.getElementById("rp_weak").classList.add("is-hidden"),document.getElementById("rpc_diff").classList.add("is-hidden"),e.value="",t.value="",d.value=""):400===s.status&&s.json().then(e=>{"USERNAME_ALREADY_EXISTS"==e?document.getElementById("ru_exists").classList.remove("is-hidden"):"PASSWORD_TOO_WEEK"==e||e.startsWith("PASSWORD_STRENGTH:")?document.getElementById("rp_weak").classList.remove("is-hidden"):"DIFFERENT_PASSWORDS"==e&&document.getElementById("rpc_diff").classList.remove("is-hidden")})},function(e){})}function modal_folder(e){folder_input.value="",null==e?(folder_hid.value="",folder_title_add.classList.remove("is-hidden"),folder_title_edit.classList.add("is-hidden")):(folder_hid.value=e,folder_input.value=document.getElementById("f_"+e).textContent.trim(),folder_title_add.classList.add("is-hidden"),folder_title_edit.classList.remove("is-hidden")),folder_modal.classList.add("is-active")}function save_folder(){folder_msg_length.classList.add("is-hidden"),folder_msg_exists.classList.add("is-hidden"),folder_input.value.length<3||folder_input.value.length>64?folder_msg_length.classList.remove("is-hidden"):""==folder_hid.value?q("folders/","POST",folder_input.value).then(e=>{201===e.status?(folders.push({hash_id:e.text(),name:folder_input.value}),folders.sort(sort_by_name),display_folders(),folder_modal.classList.remove("is-active"),folder_input.value=""):folder_msg_exists.classList.remove("is-hidden")}):q("folders/"+folder_hid.value,"PATCH",folder_input.value).then(e=>{if(204===e.status){for(var t=0;t<folders.length;t++)if(folders[t].hash_id==folder_hid.value){folders[t].name=folder_input.value,folders.sort(sort_by_name);break}display_folders(),folder_modal.classList.remove("is-active"),folder_hid.value="",folder_input.value=""}else folder_msg_exists.classList.remove("is-hidden")})}function delete_folder(e){q("folders/"+e,"DELETE",null).then(t=>{if(204===t.status){var d=document.getElementById("f_"+e),s=[];for(const t of folders)t.hash_id!=e&&s.push(t);d.parentElement.remove()}})}function is_valid_http_url(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}function modal_feed(e){null==e?(feed_hid.value="",feed_title_add.classList.remove("is-hidden"),feed_title_edit.classList.add("is-hidden")):(feed_hid.value=e,feed_input.value=document.getElementById("r_"+e).textContent.trim(),feed_title_add.classList.add("is-hidden"),feed_title_edit.classList.remove("is-hidden")),feed_modal.classList.add("is-active")}function save_feed(){if(feed_msg_url.classList.add("is-hidden"),feed_msg_folder.classList.add("is-hidden"),feed_msg_selector.classList.add("is-hidden"),feed_msg_exists.classList.add("is-hidden"),feed_msg_checking.classList.add("is-hidden"),is_valid_http_url(feed_url.value))if(""!=feed_folder.value&&-1!=feed_folder.selectedIndex){var e={url:feed_url.value,folder:feed_folder.value,name:feed_name.value,selector:feed_selector.value,inject:feed_inject.checked};feed_msg_checking.classList.remove("is-hidden"),""==feed_hid.value?q("feeds/","POST",e).then(e=>{201===e.status?display_feeds():feed_msg_exists.classList.remove("is-hidden")}):q("feeds/"+feed_hid.value,"PATCH",e).then(e=>{if(204===e.status){for(var t=0;t<folders.length&&folders[t].hash_id!=folder_hid.value;t++);display_feeds()}else feed_msg_exists.classList.remove("is-hidden")}),feed_modal.classList.remove("is-active"),feed_hid.value="",feed_url.value="",feed_selector.value="",feed_folder.selectedIndex=-1,feed_name="",feed_inject.checked=!0}else feed_msg_folder.classList.remove("is-hidden");else feed_msg_url.classList.remove("is-hidden")}function display_feeds(){}function sort_by_name(e,t){let d=e.name.toLowerCase(),s=t.name.toLowerCase();return d<s?-1:d>s?1:0}var folders=[];window.onload=function(){var e=localStorage.getItem("token");null!=e&&(update_ui(!0),q("tokens/"+e,"PATCH",null).then(e=>{200===e.status&&e.json().then(e=>{localStorage.setItem("token",e)})}))},document.addEventListener("DOMContentLoaded",()=>{function e(e){e.classList.add("is-active")}function t(e){e.classList.remove("is-active")}function d(){(document.querySelectorAll(".modal")||[]).forEach(e=>{t(e)})}(document.querySelectorAll(".js-modal-trigger")||[]).forEach(t=>{const d=t.dataset.target,s=document.getElementById(d);t.addEventListener("click",()=>{e(s)})}),(document.querySelectorAll(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .cancel")||[]).forEach(e=>{const d=e.closest(".modal");e.addEventListener("click",()=>{t(d)})}),document.addEventListener("keydown",e=>{const t=e||window.event;"Escape"==t.key&&d()})});let folder_input=document.getElementById("folder"),folder_hid=document.getElementById("folder_hid"),folder_msg_length=document.getElementById("md-length"),folder_msg_exists=document.getElementById("md-exists"),folder_modal=document.getElementById("md"),folder_title_add=document.getElementById("mdta"),folder_title_edit=document.getElementById("mdte"),feed_modal=document.getElementById("mr"),feed_hid=document.getElementById("feed_hid"),feed_url=document.getElementById("feed_url"),feed_name=document.getElementById("feed_name"),feed_selector=document.getElementById("feed_selector"),feed_folder=document.getElementById("feed_folder"),feed_inject=document.getElementById("feed_inject"),feed_msg_url=document.getElementById("mr-url"),feed_msg_folder=document.getElementById("mr-folder"),feed_msg_selector=document.getElementById("mr-selector"),feed_msg_exists=document.getElementById("mr-exists"),feed_msg_checking=document.getElementById("mr-links"),feed_title_add=document.getElementById("mrta"),feed_title_edit=document.getElementById("mrte");