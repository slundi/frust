var folders=[];async function q(url,method,data){var h={Accept:"application/json","Content-Type":"application/json"},token=localStorage.getItem("token");null!=token&&(h.Authorization="token "+token);var request={method:method,headers:h};null!=data&&(request.body=JSON.stringify(data));const response=await fetch(url,request);return response}function get_link(href,html,classes){var a=document.createElement("a");return a.setAttribute("href",href),null!=classes&&a.setAttribute("class",classes),a.innerHTML=html,a}function get_folder_dropdown(hash_id){var e=document.createElement("div");e.setAttribute("class","dropdown is-hoverable");var t=document.createElement("div");t.setAttribute("class","dropdown-trigger"),t.innerHTML='<button class="button is-small"><span>...</span></button>',e.append(t);var m=document.createElement("div");m.setAttribute("class","dropdown-menu"),m.setAttribute("id","ddd-"+hash_id),e.append(m);var c=document.createElement("div");c.setAttribute("class","dropdown-content"),c.append(get_link("javascript:read_folder('"+hash_id+"')",'<i class="mdi mdi-check-all"></i> Mark all as read',"dropdown-item")),c.append(get_link("javascript:share('"+hash_id+"')",'<i class="mdi mdi-share-variant"></i> Share',"dropdown-item")),c.append(get_link("javascript:filter_folder('"+hash_id+"')",'<i class="mdi mdi-filter-cog"></i> Filter',"dropdown-item")),c.append(get_link("javascript:modal_folder('"+hash_id+"')",'<i class="mdi mdi-form-textbox"></i> Rename',"dropdown-item"));var h=document.createElement("hr");return h.setAttribute("class","dropdown-divider"),c.append(h),c.append(get_link("javascript:delete_folder('"+hash_id+"')",'<i class="mdi mdi-delete"></i> Delete',"dropdown-item")),m.append(c),e}function display_folders(){var el=document.getElementById("folders"),el2=document.getElementById("feed_folder");el.textContent="",el2.textContent="";for(const f of folders){const id=f.hash_id;var e=document.createElement("li"),link=document.createElement("a");link.setAttribute("href","#"),link.setAttribute("id","f_"+id),link.innerHTML='<i class="mdi mdi-folder"></i> '+f.name,console.log("TODO FOLDERS"),e.append(link);var right=document.createElement("span");right.setAttribute("class","is-pullled-right");var badge=document.createElement("div");badge.textContent="0",badge.setAttribute("id","f_n_"+id),badge.setAttribute("class","tag is-rounded"),right.append(badge),right.append(get_folder_dropdown(id)),e.append(right),el.append(e);var e2=document.createElement("option");e2.setAttribute("value",id),e2.textContent=f.name,el2.append(e2)}}function get_folders(){q("folders/","GET",null).then(response=>{200===response.status&&response.json().then(l=>{folders=l,display_folders()})})}function update_ui(logged){let els=Array.from(document.getElementsByClassName("l"));logged?(els.forEach(e=>{e.classList.remove("is-hidden")}),document.getElementById("anonymous").classList.add("is-hidden"),get_folders(),q("feeds/","GET",null).then(response=>{200===response.status&&console.log("TODO FEEDS")})):(els.forEach(e=>{e.classList.add("is-hidden")}),document.getElementById("anonymous").classList.remove("is-hidden"))}function logout(){localStorage.clear(),update_ui(!1)}function login(){let u,p;q("login","POST",{username:document.getElementById("lu").value,clear_password:document.getElementById("lp").value}).then(response=>{200===response.status?(document.getElementById("wrong_credentials").classList.add("is-hidden"),response.json().then(v=>{localStorage.setItem("token",v),update_ui(!0)})):document.getElementById("wrong_credentials").classList.remove("is-hidden")},(function(err){}))}function register(){let u=document.getElementById("ru"),p=document.getElementById("rp"),p2=document.getElementById("rpc");p.value!=p2.value&&document.getElementById("rpc_diff").classList.remove("is-hidden"),q("account","POST",{username:u.value,clear_password:p.value,clear_password_2:p2.value}).then(response=>{201===response.status?(document.getElementById("ru_exists").classList.add("is-hidden"),document.getElementById("rp_weak").classList.add("is-hidden"),document.getElementById("rpc_diff").classList.add("is-hidden"),u.value="",p.value="",p2.value=""):400===response.status&&response.json().then(msg=>{"USERNAME_ALREADY_EXISTS"==msg?document.getElementById("ru_exists").classList.remove("is-hidden"):"PASSWORD_TOO_WEEK"==msg||msg.startsWith("PASSWORD_STRENGTH:")?document.getElementById("rp_weak").classList.remove("is-hidden"):"DIFFERENT_PASSWORDS"==msg&&document.getElementById("rpc_diff").classList.remove("is-hidden")})},(function(err){}))}window.onload=function(){var token=localStorage.getItem("token");null!=token&&(update_ui(!0),q("tokens/"+token,"PATCH",null).then(response=>{200===response.status&&response.json().then(v=>{localStorage.setItem("token",v)})}))},document.addEventListener("DOMContentLoaded",()=>{function openModal($el){$el.classList.add("is-active")}function closeModal($el){$el.classList.remove("is-active")}function closeAllModals(){(document.querySelectorAll(".modal")||[]).forEach($modal=>{closeModal($modal)})}(document.querySelectorAll(".js-modal-trigger")||[]).forEach($trigger=>{const modal=$trigger.dataset.target,$target=document.getElementById(modal);$trigger.addEventListener("click",()=>{openModal($target)})}),(document.querySelectorAll(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .cancel")||[]).forEach($close=>{const $target=$close.closest(".modal");$close.addEventListener("click",()=>{closeModal($target)})}),document.addEventListener("keydown",event=>{const e=event||window.event;"Escape"==e.key&&closeAllModals()})});let folder_input=document.getElementById("folder"),folder_hid=document.getElementById("folder_hid"),folder_msg_length=document.getElementById("md-length"),folder_msg_exists=document.getElementById("md-exists"),folder_modal=document.getElementById("md"),folder_title_add=document.getElementById("mdta"),folder_title_edit=document.getElementById("mdte");function modal_folder(hid){folder_input.value="",null==hid?(folder_hid.value="",folder_title_add.classList.remove("is-hidden"),folder_title_edit.classList.add("is-hidden")):(folder_hid.value=hid,folder_input.value=document.getElementById("f_"+hid).textContent.trim(),folder_title_add.classList.add("is-hidden"),folder_title_edit.classList.remove("is-hidden")),folder_modal.classList.add("is-active")}function save_folder(){folder_msg_length.classList.add("is-hidden"),folder_msg_exists.classList.add("is-hidden"),folder_input.value.length<3||folder_input.value.length>64?folder_msg_length.classList.remove("is-hidden"):""==folder_hid.value?q("folders/","POST",folder_input.value).then(response=>{201===response.status?(folders.push({hash_id:response.text(),name:folder_input.value}),folders.sort(sort_by_name),display_folders(),folder_modal.classList.remove("is-active"),folder_input.value=""):folder_msg_exists.classList.remove("is-hidden")}):q("folders/"+folder_hid.value,"PATCH",folder_input.value).then(response=>{if(204===response.status){for(var i=0;i<folders.length;i++)if(folders[i].hash_id==folder_hid.value){folders[i].name=folder_input.value,folders.sort(sort_by_name);break}display_folders(),folder_modal.classList.remove("is-active"),folder_hid.value="",folder_input.value=""}else folder_msg_exists.classList.remove("is-hidden")})}function delete_folder(hash_id){q("folders/"+hash_id,"DELETE",null).then(response=>{if(204===response.status){var e=document.getElementById("f_"+hash_id),b=[];for(const f of folders)f.hash_id!=hash_id&&b.push(f);e.parentElement.remove()}})}let feed_modal=document.getElementById("mr"),feed_hid=document.getElementById("feed_hid"),feed_url=document.getElementById("feed_url"),feed_name=document.getElementById("feed_name"),feed_xpath=document.getElementById("feed_xpath"),feed_folder=document.getElementById("feed_folder"),feed_inject=document.getElementById("feed_inject"),feed_msg_url=document.getElementById("mr-url"),feed_msg_folder=document.getElementById("mr-folder"),feed_msg_xpath=document.getElementById("mr-xpath"),feed_msg_exists=document.getElementById("mr-exists"),feed_msg_checking=document.getElementById("mr-links"),feed_title_add=document.getElementById("mrta"),feed_title_edit=document.getElementById("mrte");function is_valid_http_url(string){let url;try{url=new URL(string)}catch(_){return!1}return"http:"===url.protocol||"https:"===url.protocol}function modal_feed(hid){null==hid?(feed_hid.value="",feed_title_add.classList.remove("is-hidden"),feed_title_edit.classList.add("is-hidden")):(feed_hid.value=hid,feed_input.value=document.getElementById("r_"+hid).textContent.trim(),feed_title_add.classList.add("is-hidden"),feed_title_edit.classList.remove("is-hidden")),feed_modal.classList.add("is-active")}function save_feed(){if(feed_msg_url.classList.add("is-hidden"),feed_msg_folder.classList.add("is-hidden"),feed_msg_xpath.classList.add("is-hidden"),feed_msg_exists.classList.add("is-hidden"),feed_msg_checking.classList.add("is-hidden"),is_valid_http_url(feed_url.value))if(""!=feed_folder.value&&-1!=feed_folder.selectedIndex){var data={url:feed_url.value,folder:feed_folder.value,name:feed_name.value,xpath:feed_xpath.value,inject:feed_inject.checked};feed_msg_checking.classList.remove("is-hidden"),""==feed_hid.value?q("feeds/","POST",data).then(response=>{201===response.status?display_feeds():feed_msg_exists.classList.remove("is-hidden")}):q("feeds/"+feed_hid.value,"PATCH",data).then(response=>{if(204===response.status){for(var i=0;i<folders.length&&folders[i].hash_id!=folder_hid.value;i++);display_feeds()}else feed_msg_exists.classList.remove("is-hidden")}),feed_modal.classList.remove("is-active"),feed_hid.value="",feed_url.value="",feed_xpath.value="",feed_folder.selectedIndex=-1,feed_name="",feed_inject.checked=!0}else feed_msg_folder.classList.remove("is-hidden");else feed_msg_url.classList.remove("is-hidden")}function display_feeds(){}function sort_by_name(a,b){let na=a.name.toLowerCase(),nb=b.name.toLowerCase();return na<nb?-1:na>nb?1:0}